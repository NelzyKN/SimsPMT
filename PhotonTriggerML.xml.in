<?xml version="1.0" encoding="iso-8859-1"?>

<!-- Configuration of PhotonTriggerML Module (SUPERVISED VERSION) -->

<PhotonTriggerML>

  <!-- Energy range for trigger application -->
  <EnergyMin unit="eV"> 1e18 </EnergyMin>
  <EnergyMax unit="eV"> 1e19 </EnergyMax>

  <!-- Photon classification threshold (will be dynamically adjusted) -->
  <PhotonThreshold> 0.5 </PhotonThreshold>
  
  <!-- Target efficiency for photon detection (used for dynamic threshold) -->
  <TargetEfficiency> 0.7 </TargetEfficiency>

  <!-- Use ensemble classifier (recommended) -->
  <UseEnsemble> true </UseEnsemble>
  
  <!-- Enable dynamic threshold adjustment based on performance -->
  <DynamicThreshold> true </DynamicThreshold>
  
  <!-- Save detailed features for analysis -->
  <SaveFeatures> true </SaveFeatures>

  <!-- Output file for ML results and diagnostics -->
  <OutputFile> photon_trigger_ml_supervised.root </OutputFile>

  <!-- Weights file for saving/loading trained model -->
  <WeightsFile> photon_trigger_weights_supervised.dat </WeightsFile>
  
  <!-- Log file for performance tracking -->
  <LogFile> photon_trigger_ml_supervised.log </LogFile>

  <!-- Training configuration -->
  <TrainingParameters>
    <!-- Learning rate for neural network (with exponential decay) -->
    <InitialLearningRate> 0.001 </InitialLearningRate>
    <LearningRateDecay> 0.9995 </LearningRateDecay>
    
    <!-- Batch size for balanced training -->
    <BatchSize> 64 </BatchSize>
    
    <!-- Training frequency (every N events) -->
    <TrainEveryNEvents> 20 </TrainEveryNEvents>
    
    <!-- Maximum training buffer size -->
    <MaxBufferSize> 10000 </MaxBufferSize>
  </TrainingParameters>

  <!-- Ensemble weights (physics-motivated) -->
  <EnsembleWeights>
    <!-- Muon content is the strongest discriminator -->
    <MuonContentWeight> 0.5 </MuonContentWeight>
    
    <!-- Time profile differences -->
    <TimeProfileWeight> 0.3 </TimeProfileWeight>
    
    <!-- Overall pulse shape -->
    <PulseShapeWeight> 0.2 </PulseShapeWeight>
  </EnsembleWeights>

  <!-- Feature extraction parameters -->
  <FeatureExtraction>
    <!-- PMT baseline value -->
    <Baseline unit="ADC"> 50 </Baseline>
    
    <!-- ADC to VEM conversion factor -->
    <ADCPerVEM> 180 </ADCPerVEM>
    
    <!-- Time windows for charge distribution (bins relative to peak) -->
    <VeryEarlyWindow> -2000 -500 </VeryEarlyWindow>
    <EarlyWindow> -500 -200 </EarlyWindow>
    <PeakWindow> -200 200 </PeakWindow>
    <LateWindow> 200 500 </LateWindow>
    <VeryLateWindow> 500 2000 </VeryLateWindow>
    
    <!-- Muon bump detection window -->
    <MuonBumpStart> 600 </MuonBumpStart>
    <MuonBumpEnd> 1500 </MuonBumpEnd>
  </FeatureExtraction>

  <!-- Neural network architecture -->
  <NetworkArchitecture>
    <!-- Number of physics features -->
    <InputSize> 18 </InputSize>
    
    <!-- Hidden layer sizes -->
    <HiddenLayer1> 32 </HiddenLayer1>
    <HiddenLayer2> 16 </HiddenLayer2>
    
    <!-- Activation function (relu or sigmoid) -->
    <Activation> relu </Activation>
    
    <!-- Dropout rate for regularization -->
    <DropoutRate> 0.2 </DropoutRate>
  </NetworkArchitecture>

  <!-- Performance monitoring -->
  <PerformanceMonitoring>
    <!-- Moving average window for metrics -->
    <PerformanceWindow> 100 </PerformanceWindow>
    
    <!-- Display metrics every N events -->
    <DisplayEveryNEvents> 10 </DisplayEveryNEvents>
    
    <!-- Update threshold every N events -->
    <UpdateThresholdEveryNEvents> 50 </UpdateThresholdEveryNEvents>
  </PerformanceMonitoring>

  <!-- Diagnostic options -->
  <Diagnostics>
    <!-- Enable verbose logging -->
    <VerboseLogging> true </VerboseLogging>
    
    <!-- Save confusion matrix -->
    <SaveConfusionMatrix> true </SaveConfusionMatrix>
    
    <!-- Save feature importance analysis -->
    <SaveFeatureImportance> true </SaveFeatureImportance>
    
    <!-- Save score distributions -->
    <SaveScoreDistributions> true </SaveScoreDistributions>
  </Diagnostics>

</PhotonTriggerML>
